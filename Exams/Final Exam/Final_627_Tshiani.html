<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.555">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>STAT-427/627 Final 24S</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="Final_627_Tshiani_files/libs/clipboard/clipboard.min.js"></script>
<script src="Final_627_Tshiani_files/libs/quarto-html/quarto.js"></script>
<script src="Final_627_Tshiani_files/libs/quarto-html/popper.min.js"></script>
<script src="Final_627_Tshiani_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="Final_627_Tshiani_files/libs/quarto-html/anchor.min.js"></script>
<link href="Final_627_Tshiani_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="Final_627_Tshiani_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="Final_627_Tshiani_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="Final_627_Tshiani_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="Final_627_Tshiani_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">STAT-427/627 Final 24S</h1>
<p class="subtitle lead">Name: _______________________________ Course: _____________</p>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>Be brief but show your reasoning (partial credit?). <strong>Label your work and answers for each problem if on a different page.</strong> Put your name on each piece of paper. You can use your notes, textbook, calculator, and computer and the internet to access course materials.</p>
<ul>
<li><p>Recommend you do the problem one plots on paper instead of taking the time to code. Turn in the paper and as an option, you con take a picture and put the file in the same folder as your code file. Use the following rmarkdown syntax at the appropriate location to embed the file into your output. <img src="myfile.png" class="img-fluid" alt="My caption">.</p></li>
<li><p>Each problem is 20 points. Total points = 40. Time = 2 hr 30 min.</p></li>
</ul>
<section id="insurance-predictions-do-by-hand." class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Insurance Predictions: Do by hand.</h1>
<p>An insurance company wants to predict if a new customer will have a major operation within 10 years. They select 11 customers at random as training data to predict an operation based on the customer’s age and their average annual cost of medical care.</p>
<table class="caption-top table">
<colgroup>
<col style="width: 24%">
<col style="width: 6%">
<col style="width: 6%">
<col style="width: 6%">
<col style="width: 6%">
<col style="width: 6%">
<col style="width: 6%">
<col style="width: 6%">
<col style="width: 6%">
<col style="width: 6%">
<col style="width: 6%">
<col style="width: 6%">
</colgroup>
<thead>
<tr class="header">
<th>Person</th>
<th style="text-align: center;">A</th>
<th style="text-align: center;">B</th>
<th style="text-align: center;">C</th>
<th style="text-align: center;">D</th>
<th style="text-align: center;">E</th>
<th style="text-align: center;">F</th>
<th style="text-align: center;">G</th>
<th style="text-align: center;">H</th>
<th style="text-align: center;">I</th>
<th style="text-align: center;">J</th>
<th style="text-align: center;">K</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Age</td>
<td style="text-align: center;">20</td>
<td style="text-align: center;">22</td>
<td style="text-align: center;">23</td>
<td style="text-align: center;">24</td>
<td style="text-align: center;">25</td>
<td style="text-align: center;">26</td>
<td style="text-align: center;">27</td>
<td style="text-align: center;">29</td>
<td style="text-align: center;">32</td>
<td style="text-align: center;">35</td>
<td style="text-align: center;">37</td>
</tr>
<tr class="even">
<td>Average Cost</td>
<td style="text-align: center;">5</td>
<td style="text-align: center;">11</td>
<td style="text-align: center;">8</td>
<td style="text-align: center;">9</td>
<td style="text-align: center;">15</td>
<td style="text-align: center;">19</td>
<td style="text-align: center;">24</td>
<td style="text-align: center;">21</td>
<td style="text-align: center;">18</td>
<td style="text-align: center;">20</td>
<td style="text-align: center;">17</td>
</tr>
<tr class="odd">
<td>Had an Operation</td>
<td style="text-align: center;">N</td>
<td style="text-align: center;">Y</td>
<td style="text-align: center;">N</td>
<td style="text-align: center;">N</td>
<td style="text-align: center;">N</td>
<td style="text-align: center;">Y</td>
<td style="text-align: center;">Y</td>
<td style="text-align: center;">N</td>
<td style="text-align: center;">N</td>
<td style="text-align: center;">Y</td>
<td style="text-align: center;">Y</td>
</tr>
</tbody>
</table>
<p>To classify future insured, the company partitions its predictor space (Age, Cost) as on the right (see hard copy).</p>
<p>(a) Plot the persons <em>using their label</em> on the partition plot.</p>
<ul>
<li>Draw a classification tree that corresponds to this partition.</li>
<li>At each internal node, state the splitting condition and threshold.</li>
<li>At each terminal (leaf) node, state the predicted response.</li>
</ul>
<p>(b) Fill in the following table with the prediction for each point based on your tree.</p>
<ul>
<li>Fill out the confusion matrix.</li>
<li>Calculate the <em>training</em> classification rate from the confusion matrix.</li>
</ul>
<table class="caption-top table">
<colgroup>
<col style="width: 24%">
<col style="width: 6%">
<col style="width: 6%">
<col style="width: 6%">
<col style="width: 6%">
<col style="width: 6%">
<col style="width: 6%">
<col style="width: 6%">
<col style="width: 6%">
<col style="width: 6%">
<col style="width: 6%">
<col style="width: 6%">
</colgroup>
<thead>
<tr class="header">
<th>Person</th>
<th style="text-align: center;">A</th>
<th style="text-align: center;">B</th>
<th style="text-align: center;">C</th>
<th style="text-align: center;">D</th>
<th style="text-align: center;">E</th>
<th style="text-align: center;">F</th>
<th style="text-align: center;">G</th>
<th style="text-align: center;">H</th>
<th style="text-align: center;">I</th>
<th style="text-align: center;">J</th>
<th style="text-align: center;">K</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Age</td>
<td style="text-align: center;">20</td>
<td style="text-align: center;">22</td>
<td style="text-align: center;">23</td>
<td style="text-align: center;">24</td>
<td style="text-align: center;">25</td>
<td style="text-align: center;">26</td>
<td style="text-align: center;">27</td>
<td style="text-align: center;">29</td>
<td style="text-align: center;">32</td>
<td style="text-align: center;">35</td>
<td style="text-align: center;">37</td>
</tr>
<tr class="even">
<td>Average Cost</td>
<td style="text-align: center;">5</td>
<td style="text-align: center;">11</td>
<td style="text-align: center;">8</td>
<td style="text-align: center;">9</td>
<td style="text-align: center;">15</td>
<td style="text-align: center;">19</td>
<td style="text-align: center;">24</td>
<td style="text-align: center;">21</td>
<td style="text-align: center;">18</td>
<td style="text-align: center;">20</td>
<td style="text-align: center;">17</td>
</tr>
<tr class="odd">
<td>Had an Operation</td>
<td style="text-align: center;">N</td>
<td style="text-align: center;">Y</td>
<td style="text-align: center;">N</td>
<td style="text-align: center;">N</td>
<td style="text-align: center;">N</td>
<td style="text-align: center;">Y</td>
<td style="text-align: center;">Y</td>
<td style="text-align: center;">N</td>
<td style="text-align: center;">N</td>
<td style="text-align: center;">Y</td>
<td style="text-align: center;">Y</td>
</tr>
<tr class="even">
<td>Prediction?</td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
</tr>
</tbody>
</table>
<table class="caption-top table">
<tbody>
<tr class="odd">
<td style="text-align: center;"></td>
<td style="text-align: center;">Pred Yes</td>
<td style="text-align: center;">Pred No</td>
</tr>
<tr class="even">
<td style="text-align: center;">Actual-Yes</td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
</tr>
<tr class="odd">
<td style="text-align: center;">Actual-No</td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
</tr>
</tbody>
</table>
<ul>
<li>Classification Rate?</li>
</ul>
<p>(c) A random forest is constructed for the same data. It has 3 trees and each is pruned to 1 split with 2 terminal nodes:</p>
<ul>
<li>The 1st tree sample is persons A, C, C, D, E, E, F, F, F, G, I. It splits on Cost.</li>
<li>The 2nd tree sample is persons A, C, D, D, E, F, F, G, G, H, K. It splits on Age.</li>
<li>The 3rd tree sample is persons A, A, D, D, E, E, F, G, J, K, K. It splits on Cost.</li>
</ul>
<p>The following table summarizes the data for the forest.</p>
<div class="table-striped">
<table class="caption-top table">
<colgroup>
<col style="width: 24%">
<col style="width: 6%">
<col style="width: 6%">
<col style="width: 6%">
<col style="width: 6%">
<col style="width: 6%">
<col style="width: 6%">
<col style="width: 6%">
<col style="width: 6%">
<col style="width: 6%">
<col style="width: 6%">
<col style="width: 6%">
</colgroup>
<thead>
<tr class="header">
<th>Person</th>
<th style="text-align: center;">A</th>
<th style="text-align: center;">B</th>
<th style="text-align: center;">C</th>
<th style="text-align: center;">D</th>
<th style="text-align: center;">E</th>
<th style="text-align: center;">F</th>
<th style="text-align: center;">G</th>
<th style="text-align: center;">H</th>
<th style="text-align: center;">I</th>
<th style="text-align: center;">J</th>
<th style="text-align: center;">K</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Age</td>
<td style="text-align: center;">20</td>
<td style="text-align: center;">22</td>
<td style="text-align: center;">23</td>
<td style="text-align: center;">24</td>
<td style="text-align: center;">25</td>
<td style="text-align: center;">26</td>
<td style="text-align: center;">27</td>
<td style="text-align: center;">29</td>
<td style="text-align: center;">32</td>
<td style="text-align: center;">35</td>
<td style="text-align: center;">37</td>
</tr>
<tr class="even">
<td>Average Cost</td>
<td style="text-align: center;">5</td>
<td style="text-align: center;">11</td>
<td style="text-align: center;">8</td>
<td style="text-align: center;">9</td>
<td style="text-align: center;">15</td>
<td style="text-align: center;">19</td>
<td style="text-align: center;">24</td>
<td style="text-align: center;">21</td>
<td style="text-align: center;">18</td>
<td style="text-align: center;">20</td>
<td style="text-align: center;">17</td>
</tr>
<tr class="odd">
<td>Had an Operation</td>
<td style="text-align: center;">N</td>
<td style="text-align: center;">Y</td>
<td style="text-align: center;">N</td>
<td style="text-align: center;">N</td>
<td style="text-align: center;">N</td>
<td style="text-align: center;">Y</td>
<td style="text-align: center;">Y</td>
<td style="text-align: center;">N</td>
<td style="text-align: center;">N</td>
<td style="text-align: center;">Y</td>
<td style="text-align: center;">Y</td>
</tr>
<tr class="even">
<td>Tree 1</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;"></td>
<td style="text-align: center;">2</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">2</td>
<td style="text-align: center;">3</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;"></td>
<td style="text-align: center;">1</td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
</tr>
<tr class="odd">
<td>Tree 2</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;"></td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">2</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">2</td>
<td style="text-align: center;">2</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;">1</td>
</tr>
<tr class="even">
<td>Tree 3</td>
<td style="text-align: center;">2</td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;">2</td>
<td style="text-align: center;">2</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">2</td>
</tr>
</tbody>
</table>
</div>
<ul>
<li>In the following plots, put a number next to each point for how many times it is in the tree and line through the Out-Of-Bag points</li>
<li>For each tree, draw a single partition for the given variable at the threshold which creates the terminal nodes as pure as possible.</li>
<li>Below the three plots, for each tree, indicate the number of pure nodes (if any) for each tree and your calculation of the threshold value based on the closest points on either side of the threshold. You do <strong>not</strong> need to calculate the Gini impurity index.</li>
<li>For each tree, plot a New customer with age 26 with an average cost of 18.</li>
<li>Use this random forest to predict whether the New customer will have an operation and explain your reasoning for the prediction.</li>
</ul>
<p>Number of pure nodes, Threshold, and Prediction for each tree?</p>
<p>The 1<sup>st</sup> tree:</p>
<p>The 2<sup>nd</sup> tree:</p>
<p>The 3<sup>rd</sup> tree:</p>
<p>Overall Prediction for the new Customer and Rationale:</p>
<p>(d) (STAT-627 only) Calculate the <em>prediction</em> error rate of the random forest in question (c), using out-of-bag (OOB) data.</p>
<ul>
<li>Using your thresholds from part (c), fill in the following table with the predictions for only the OOB persons in each tree.</li>
<li>Calculate the overall OOB prediction for each OOB person.</li>
<li>Indicate if each overall OOB prediction is an error or not (1, 0).</li>
<li>Calculate the prediction error rate.</li>
<li>What would you recommend to improve the prediction error rate?</li>
</ul>
<table class="caption-top table">
<colgroup>
<col style="width: 24%">
<col style="width: 6%">
<col style="width: 6%">
<col style="width: 6%">
<col style="width: 6%">
<col style="width: 6%">
<col style="width: 6%">
<col style="width: 6%">
<col style="width: 6%">
<col style="width: 6%">
<col style="width: 6%">
<col style="width: 6%">
</colgroup>
<thead>
<tr class="header">
<th>Person</th>
<th style="text-align: center;">A</th>
<th style="text-align: center;">B</th>
<th style="text-align: center;">C</th>
<th style="text-align: center;">D</th>
<th style="text-align: center;">E</th>
<th style="text-align: center;">F</th>
<th style="text-align: center;">G</th>
<th style="text-align: center;">H</th>
<th style="text-align: center;">I</th>
<th style="text-align: center;">J</th>
<th style="text-align: center;">K</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Tree 1</td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
</tr>
<tr class="even">
<td>Tree 2</td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
</tr>
<tr class="odd">
<td>Tree 3</td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
</tr>
<tr class="even">
<td>——————</td>
<td style="text-align: center;">—</td>
<td style="text-align: center;">—</td>
<td style="text-align: center;">—</td>
<td style="text-align: center;">—</td>
<td style="text-align: center;">—</td>
<td style="text-align: center;">—</td>
<td style="text-align: center;">—</td>
<td style="text-align: center;">–</td>
<td style="text-align: center;">—</td>
<td style="text-align: center;">—</td>
<td style="text-align: center;">—</td>
</tr>
<tr class="odd">
<td>Predicted</td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
</tr>
<tr class="even">
<td>Had an Operation</td>
<td style="text-align: center;">N</td>
<td style="text-align: center;">Y</td>
<td style="text-align: center;">N</td>
<td style="text-align: center;">N</td>
<td style="text-align: center;">N</td>
<td style="text-align: center;">Y</td>
<td style="text-align: center;">Y</td>
<td style="text-align: center;">N</td>
<td style="text-align: center;">N</td>
<td style="text-align: center;">Y</td>
<td style="text-align: center;">Y</td>
</tr>
<tr class="odd">
<td>Error?</td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
</tr>
</tbody>
</table>
<p>(e) Is there a <em>maximal margin</em> classifier for this dataset? Explain your answer. Consider drawing some lines on the scatterplot you created in (a).</p>
<p>(f) Consider the following plot from an SVM classifier. (see hard copy)</p>
<ul>
<li>How many support vectors are there?</li>
<li>What type of kernel is being used based on the plot and why?</li>
<li>What is the training classification rate?</li>
</ul>
</section>
<section id="college-scorecard-data" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> College Scorecard Data</h1>
<p>The US Department of Education collects data from every “college” level institution in America and makes a lot of data available under the <a href="https://collegescorecard.ed.gov/">College Scorecard</a>.</p>
<ul>
<li>This question uses a curated extract of the college scorecard data. The variable names and definitions are at the end.</li>
<li>This dataset has 23 variables of data on 1,695 four-year colleges.</li>
<li>This dataset is on Canvas or at “https://raw.githubusercontent.com/AU-datascience/data/main/427-627/college_scorecard_extract_sep_2023.csv”.</li>
</ul>
<p>We want to predict the Endowment of a new colleges given the other variables as potential predictors.</p>
<p>In the following steps, build models to predict the College Endowment (<code>ENDOWBEGIN</code>) and use <span class="math inline">\(K=10\)</span>-fold cross-validation to tune and evaluate predictive performance with <strong><code>set.seed(123)</code> as appropriate.</strong></p>
<ul>
<li><p>For each problem, describe your approach, your R code, the most important results, and your interpretation of the results.</p></li>
<li><p>You may write your responses on this document by hand after running code in R and/or submit a file on Canvas with your approach, code, results, and interpretation of results.</p></li>
</ul>
<section id="multiple-linear-regression-regularization" class="level2" data-number="2.1">
<h2 data-number="2.1" class="anchored" data-anchor-id="multiple-linear-regression-regularization"><span class="header-section-number">2.1</span> Multiple Linear Regression Regularization</h2>
<ul>
<li>Load the data and assign the name <code>college</code> to it. Get rid of any records with <code>NA</code>s and divided <code>ENDOWBEGIN</code> by 1 million to reduce the scale. Glimpse <code>college</code>.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>college <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"https://raw.githubusercontent.com/AU-datascience/data/main/427-627/college_scorecard_extract_sep_2023.csv"</span>)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>college <span class="ot">&lt;-</span> <span class="fu">na.omit</span>(college)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>college<span class="sc">$</span>ENDOWBEGIN <span class="ot">&lt;-</span> college<span class="sc">$</span>ENDOWBEGIN<span class="sc">/</span><span class="dv">1000000</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="co">#college &lt;- read_csv("./data/college_scorecard_extract_sep_2023.csv")</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="co">#glimpse(college) </span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>Fit a multiple linear regression of Endowment (<span class="math inline">\(ENDOWBEGIN\)</span>) on all the other variables as a full model.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>full_model <span class="ot">&lt;-</span> <span class="fu">lm</span>(ENDOWBEGIN <span class="sc">~</span> ., <span class="at">data =</span> college)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>How many predictors appear important with a <span class="math inline">\(p\)</span> value less than 0.1?</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(full_model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = ENDOWBEGIN ~ ., data = college)

Residuals:
    Min      1Q  Median      3Q     Max 
-8188.4  -539.3    34.9   550.2 24097.4 

Coefficients:
                         Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)             2.026e+03  3.178e+03   0.638  0.52391    
ADM_RATE               -1.061e+03  3.767e+02  -2.817  0.00495 ** 
AGE_ENTRY              -7.333e+01  3.757e+01  -1.952  0.05126 .  
AVGFACSAL               4.364e-01  5.233e-02   8.340 2.82e-16 ***
CONTROLPublic          -1.116e+03  2.583e+02  -4.321 1.73e-05 ***
COSTT4_A               -1.598e-02  8.728e-03  -1.831  0.06748 .  
FEMALE                 -2.365e+02  7.230e+02  -0.327  0.74369    
FIRST_GEN               3.077e+03  1.237e+03   2.488  0.01304 *  
GRAD_DEBT_MDN          -4.500e-02  2.169e-02  -2.075  0.03828 *  
LOCALERural             3.976e+02  3.162e+02   1.257  0.20891    
LOCALESurbuban         -6.201e+01  1.474e+02  -0.421  0.67402    
LOCALETown              1.868e+02  1.613e+02   1.158  0.24714    
MD_EARN_WNE_P10        -1.483e-01  1.314e-02 -11.286  &lt; 2e-16 ***
MN_EARN_WNE_P10         1.849e-01  1.294e-02  14.284  &lt; 2e-16 ***
PCIP14                 -1.033e+03  8.105e+02  -1.274  0.20294    
PCIP27                  2.016e+04  4.720e+03   4.272 2.15e-05 ***
PFTFAC                  3.843e+01  2.756e+02   0.139  0.88912    
PCT_ASIAN              -7.123e+01  5.362e+01  -1.329  0.18435    
PCT_BLACK              -2.858e+00  2.909e+01  -0.098  0.92177    
PCT_WHITE              -1.642e+00  2.798e+01  -0.059  0.95321    
PCT_HISPANIC           -2.789e+01  1.228e+01  -2.271  0.02338 *  
PCTPELL                 5.174e+02  7.835e+02   0.660  0.50917    
REGIONGreat Lakes      -4.843e+02  3.646e+02  -1.328  0.18441    
REGIONMid-East         -8.869e+02  3.457e+02  -2.566  0.01046 *  
REGIONNew England      -8.037e+02  3.856e+02  -2.084  0.03742 *  
REGIONOutlying Regions -9.732e+02  1.748e+03  -0.557  0.57791    
REGIONPLains           -4.136e+02  3.708e+02  -1.115  0.26501    
REGIONRocky Mountains  -5.710e+02  4.615e+02  -1.237  0.21634    
REGIONSoutheast        -6.046e+02  3.867e+02  -1.563  0.11832    
REGIONSouthwest        -5.571e+02  3.730e+02  -1.493  0.13568    
SAT_AVG                -2.030e+00  1.172e+00  -1.732  0.08362 .  
UGDS                    1.666e-02  1.002e-02   1.663  0.09672 .  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 1690 on 887 degrees of freedom
Multiple R-squared:  0.5486,    Adjusted R-squared:  0.5328 
F-statistic: 34.77 on 31 and 887 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
<p>there are 6 predictors with atleast 2 stars so their p-values are less than 0.01.</p>
<ul>
<li>Which of those increase the endowment? AVGFACSAL, MN_EARN_WNE_P10, and PCIP27</li>
</ul>
<p>Do any of the variables have a high generalized variance inflation factor GVIF? If any, which ones and do they make sense as having high GVIF given the other variables?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(car)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: carData</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'car'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:dplyr':

    recode</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:purrr':

    some</code></pre>
</div>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>vif_values <span class="ot">&lt;-</span> <span class="fu">vif</span>(full_model)</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>vif_values</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                     GVIF Df GVIF^(1/(2*Df))
ADM_RATE         1.956409  1        1.398717
AGE_ENTRY        2.362937  1        1.537185
AVGFACSAL        5.856266  1        2.419972
CONTROL          5.087335  1        2.255512
COSTT4_A         7.482394  1        2.735396
FEMALE           1.812391  1        1.346251
FIRST_GEN        4.281285  1        2.069127
GRAD_DEBT_MDN    1.957953  1        1.399269
LOCALE           1.663459  3        1.088517
MD_EARN_WNE_P10 11.123241  1        3.335152
MN_EARN_WNE_P10 11.799559  1        3.435049
PCIP14           1.990121  1        1.410716
PCIP27           1.642977  1        1.281787
PFTFAC           1.208391  1        1.099268
PCT_ASIAN        7.129318  1        2.670078
PCT_BLACK       32.073927  1        5.663385
PCT_WHITE       36.596033  1        6.049465
PCT_HISPANIC     3.223241  1        1.795339
PCTPELL          3.383407  1        1.839404
REGION          11.251857  8        1.163326
SAT_AVG          7.508675  1        2.740196
UGDS             2.070544  1        1.438939</code></pre>
</div>
</div>
<p>using 5 as my GVIF threshold, it appears the following variables may be subject to multicollinearity: AVGFACSAL, CONTROL, COSTT4_A, MD_EARN_WNE_P10, MN_EARN_WNE_P10, PCT_BLACK, PCT_ASIAN, PCT_WHITE, REGION, SAT_AVG</p>
<p>Refit a reduced model without <code>MN_EARN_WNE_P10</code> and <code>PCT_WHITE</code>. Are there any changes in significant variables?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>reduced_model <span class="ot">&lt;-</span> <span class="fu">lm</span>(ENDOWBEGIN <span class="sc">~</span> . <span class="sc">-</span> MN_EARN_WNE_P10 <span class="sc">-</span> PCT_WHITE, <span class="at">data =</span> college)</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(reduced_model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = ENDOWBEGIN ~ . - MN_EARN_WNE_P10 - PCT_WHITE, data = college)

Residuals:
    Min      1Q  Median      3Q     Max 
-5325.4  -636.7    -2.7   536.4 29884.2 

Coefficients:
                         Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)             6.267e+02  2.130e+03   0.294 0.768639    
ADM_RATE               -1.542e+03  4.154e+02  -3.712 0.000219 ***
AGE_ENTRY              -2.647e+01  4.141e+01  -0.639 0.522903    
AVGFACSAL               6.863e-01  5.451e-02  12.592  &lt; 2e-16 ***
CONTROLPublic          -1.388e+03  2.849e+02  -4.871 1.31e-06 ***
COSTT4_A               -1.170e-02  9.621e-03  -1.216 0.224122    
FEMALE                 -1.262e+03  7.966e+02  -1.584 0.113640    
FIRST_GEN               4.448e+03  1.366e+03   3.256 0.001173 ** 
GRAD_DEBT_MDN          -8.266e-02  2.382e-02  -3.470 0.000545 ***
LOCALERural             1.595e+02  3.497e+02   0.456 0.648466    
LOCALESurbuban         -2.191e+02  1.628e+02  -1.346 0.178639    
LOCALETown              1.859e+02  1.778e+02   1.046 0.296020    
MD_EARN_WNE_P10        -2.391e-03  9.089e-03  -0.263 0.792580    
PCIP14                 -2.056e+03  8.931e+02  -2.302 0.021564 *  
PCIP27                  2.310e+04  5.223e+03   4.423 1.09e-05 ***
PFTFAC                 -6.161e+01  3.047e+02  -0.202 0.839820    
PCT_ASIAN              -9.126e+01  3.291e+01  -2.773 0.005672 ** 
PCT_BLACK               9.374e+00  8.745e+00   1.072 0.284044    
PCT_HISPANIC           -3.261e+01  1.075e+01  -3.035 0.002476 ** 
PCTPELL                -1.279e+01  8.670e+02  -0.015 0.988237    
REGIONGreat Lakes      -2.153e+02  3.805e+02  -0.566 0.571559    
REGIONMid-East         -7.678e+02  3.620e+02  -2.121 0.034201 *  
REGIONNew England      -8.115e+02  4.148e+02  -1.956 0.050756 .  
REGIONOutlying Regions -9.512e+02  1.933e+03  -0.492 0.622754    
REGIONPLains           -1.270e+02  3.959e+02  -0.321 0.748422    
REGIONRocky Mountains  -6.060e+01  5.097e+02  -0.119 0.905381    
REGIONSoutheast        -2.466e+02  4.008e+02  -0.615 0.538519    
REGIONSouthwest         4.711e+01  4.106e+02   0.115 0.908679    
SAT_AVG                -1.167e+00  1.296e+00  -0.901 0.368010    
UGDS                    5.020e-04  1.098e-02   0.046 0.963539    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 1872 on 889 degrees of freedom
Multiple R-squared:  0.4447,    Adjusted R-squared:  0.4266 
F-statistic: 24.55 on 29 and 889 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
<p>now for significant variables we have PCT_HISPANIC, PCT_ASIAN, PCIP27, GRAD_DEBT_MDN, FIRST_GEN, CONTROLPublic, AVGFACSAL, ADM_RATE</p>
<ul>
<li>Check the GVIF again and comment on any changes.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">vif</span>(reduced_model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                    GVIF Df GVIF^(1/(2*Df))
ADM_RATE        1.938564  1        1.392323
AGE_ENTRY       2.339179  1        1.529438
AVGFACSAL       5.177903  1        2.275501
CONTROL         5.040528  1        2.245112
COSTT4_A        7.408387  1        2.721835
FEMALE          1.792726  1        1.338927
FIRST_GEN       4.255414  1        2.062865
GRAD_DEBT_MDN   1.924363  1        1.387214
LOCALE          1.626197  3        1.084415
MD_EARN_WNE_P10 4.338904  1        2.083004
PCIP14          1.968773  1        1.403130
PCIP27          1.639128  1        1.280284
PFTFAC          1.203818  1        1.097186
PCT_ASIAN       2.188334  1        1.479302
PCT_BLACK       2.360766  1        1.536479
PCT_HISPANIC    2.010628  1        1.417966
PCTPELL         3.375700  1        1.837308
REGION          8.191355  8        1.140472
SAT_AVG         7.483227  1        2.735549
UGDS            2.024164  1        1.422731</code></pre>
</div>
</div>
<p>now for variables subject to multicolinearity we have: AVGFACSAL, CONTROL, COSTT4_A, REGION, SAT_AVG.</p>
<ul>
<li>Create a new data frame with the variables below (you can use the following code).
<ul>
<li>Remove the rows with <code>REGION = "Outlying Regions"</code>.</li>
<li>Convert all character variables to factors.</li>
</ul></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>college <span class="sc">|&gt;</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>     ENDOWBEGIN, ADM_RATE, AVGFACSAL, CONTROL,FIRST_GEN, GRAD_DEBT_MDN, PCIP27, </span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>PCT_ASIAN, REGION</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(REGION <span class="sc">!=</span> <span class="st">"Outlying Regions"</span>) <span class="sc">|&gt;</span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">where</span>(is.character), as.factor)) <span class="ot">-&gt;</span></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>college2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>Use the {boot} package with <code>college2</code> to report the prediction MSE for a full model (<code>ENDOWBEGIN</code> on the other data) based on K-10 fold cross-validation adjusted deviance.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(boot)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'boot'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:car':

    logit</code></pre>
</div>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>lm_full <span class="ot">&lt;-</span> <span class="fu">glm</span>(ENDOWBEGIN <span class="sc">~</span> ., <span class="at">data =</span> college2)</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>cv_error <span class="ot">&lt;-</span> <span class="fu">cv.glm</span>(college2, lm_full, <span class="at">K =</span> <span class="dv">10</span>)</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>cv_error<span class="sc">$</span>delta[<span class="dv">1</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 3875289</code></pre>
</div>
</div>
</section>
<section id="regularization-via-shrinkage" class="level2" data-number="2.2">
<h2 data-number="2.2" class="anchored" data-anchor-id="regularization-via-shrinkage"><span class="header-section-number">2.2</span> Regularization via Shrinkage</h2>
<p>Use LASSO with cross validation to model <code>ENDOWBEGIN</code> on the other variables in <code>college2</code> and find the best lambda.</p>
<ul>
<li>Create model matrices for <code>X</code> and <code>Y</code>.</li>
<li>Use <code>set.seed(123)</code> for the cross validation.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(glmnet)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: Matrix</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'Matrix'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:tidyr':

    expand, pack, unpack</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loaded glmnet 4.1-9</code></pre>
</div>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">model.matrix</span>(ENDOWBEGIN <span class="sc">~</span> ., college2)[, <span class="sc">-</span><span class="dv">1</span>]</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> college2<span class="sc">$</span>ENDOWBEGIN</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>Plot the result of the cross validation.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>lasso_cv <span class="ot">&lt;-</span> <span class="fu">cv.glmnet</span>(x, y, <span class="at">alpha =</span> <span class="dv">1</span>, <span class="at">standardize =</span> <span class="cn">TRUE</span>)</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(lasso_cv)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Final_627_Tshiani_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<ul>
<li>Show the result and identify whether <code>lambda-min</code> or <code>lambda.1se</code> has fewer non-zero variables?</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">coef</span>(lasso_cv, <span class="at">s =</span> <span class="st">"lambda.min"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>15 x 1 sparse Matrix of class "dgCMatrix"
                                 s0
(Intercept)           -2.512681e+03
ADM_RATE              -1.557644e+03
AVGFACSAL              5.584929e-01
CONTROLPublic         -8.723086e+02
FIRST_GEN              4.484255e+03
GRAD_DEBT_MDN         -7.331234e-02
PCIP27                 2.267653e+04
PCT_ASIAN             -9.547093e+01
REGIONGreat Lakes      1.052237e+02
REGIONMid-East        -4.603852e+02
REGIONNew England     -4.555186e+02
REGIONPLains           2.420369e+02
REGIONRocky Mountains  .           
REGIONSoutheast        2.121505e+02
REGIONSouthwest       -6.959190e+01</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">coef</span>(lasso_cv, <span class="at">s =</span> <span class="st">"lambda.1se"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>15 x 1 sparse Matrix of class "dgCMatrix"
                                 s0
(Intercept)           -1187.7901159
ADM_RATE                  .        
AVGFACSAL                 0.1990341
CONTROLPublic             .        
FIRST_GEN                 .        
GRAD_DEBT_MDN             .        
PCIP27                    .        
PCT_ASIAN                 .        
REGIONGreat Lakes         .        
REGIONMid-East            .        
REGIONNew England         .        
REGIONPLains              .        
REGIONRocky Mountains     .        
REGIONSoutheast           .        
REGIONSouthwest           .        </code></pre>
</div>
</div>
<p>lambda-min has fewer zero variables.</p>
<ul>
<li>Show the coefficients for <code>lambda.1se</code> and discuss which were driven to zero if any.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">coef</span>(lasso_cv, <span class="at">s =</span> <span class="st">"lambda.1se"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>15 x 1 sparse Matrix of class "dgCMatrix"
                                 s0
(Intercept)           -1187.7901159
ADM_RATE                  .        
AVGFACSAL                 0.1990341
CONTROLPublic             .        
FIRST_GEN                 .        
GRAD_DEBT_MDN             .        
PCIP27                    .        
PCT_ASIAN                 .        
REGIONGreat Lakes         .        
REGIONMid-East            .        
REGIONNew England         .        
REGIONPLains              .        
REGIONRocky Mountains     .        
REGIONSoutheast           .        
REGIONSouthwest           .        </code></pre>
</div>
</div>
<p>there pratically all were driven to zero except for AVGFACSAL.</p>
<ul>
<li>Do any of the +/- signs of the coefficients for the variables surprise you? using the labmda-min method, i would say a suprising result is colleges with a higher percentage of first-gen students have a higher endowement because i would expect the college to be spending the extra money on first-gen scholarships rather than the endowement.</li>
</ul>
<p>What is the cross-validated predicted MSE from the model?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>lasso_cv<span class="sc">$</span>cvm[lasso_cv<span class="sc">$</span>lambda <span class="sc">==</span> lasso_cv<span class="sc">$</span>lambda<span class="fl">.1</span>se]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 5213701</code></pre>
</div>
</div>
</section>
<section id="principal-components." class="level2" data-number="2.3">
<h2 data-number="2.3" class="anchored" data-anchor-id="principal-components."><span class="header-section-number">2.3</span> Principal components.</h2>
<p>Calculate the principal components using the <code>X</code> model matrix you created earlier, with scaling, and show the scree plot.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>pca <span class="ot">&lt;-</span> <span class="fu">prcomp</span>(x, <span class="at">scale. =</span> <span class="cn">TRUE</span>)</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(pca)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Importance of components:
                          PC1    PC2     PC3     PC4     PC5     PC6     PC7
Standard deviation     1.6527 1.2569 1.17102 1.12916 1.08923 1.05543 1.01847
Proportion of Variance 0.1951 0.1128 0.09795 0.09107 0.08474 0.07957 0.07409
Cumulative Proportion  0.1951 0.3080 0.40590 0.49698 0.58172 0.66129 0.73538
                           PC8     PC9    PC10    PC11    PC12    PC13    PC14
Standard deviation     0.98138 0.90128 0.81662 0.74145 0.63683 0.51380 0.20775
Proportion of Variance 0.06879 0.05802 0.04763 0.03927 0.02897 0.01886 0.00308
Cumulative Proportion  0.80417 0.86219 0.90982 0.94909 0.97806 0.99692 1.00000</code></pre>
</div>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(pca, <span class="at">type =</span> <span class="st">"l"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Final_627_Tshiani_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<ul>
<li>Interpret the scree plot</li>
</ul>
<p>the line gradually flattens after 2 but not quite flat. i would still recomment using 2-3 PCA components.</p>
<p>Given the scree plot, choose to create <strong>either</strong> a PCR <strong>or</strong> a PLSR model.</p>
<p>I choose PSLR</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(pls)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'pls'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:stats':

    loadings</code></pre>
</div>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>plsr_model <span class="ot">&lt;-</span> <span class="fu">plsr</span>(ENDOWBEGIN <span class="sc">~</span> ., <span class="at">data =</span> college2, <span class="at">scale =</span> <span class="cn">TRUE</span>, <span class="at">validation =</span> <span class="st">"CV"</span>)</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a><span class="fu">validationplot</span>(plsr_model, <span class="at">val.type =</span> <span class="st">"MSEP"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Final_627_Tshiani_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(plsr_model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Data:   X dimension: 918 14 
    Y dimension: 918 1
Fit method: kernelpls
Number of components considered: 14

VALIDATION: RMSEP
Cross-validated using 10 random segments.
       (Intercept)  1 comps  2 comps  3 comps  4 comps  5 comps  6 comps
CV            2475     2064     2004     1969     1957     1953     1952
adjCV         2475     2062     2000     1964     1953     1949     1948
       7 comps  8 comps  9 comps  10 comps  11 comps  12 comps  13 comps
CV        1953     1954     1957      1956      1956      1956      1956
adjCV     1949     1950     1952      1952      1952      1952      1952
       14 comps
CV         1956
adjCV      1952

TRAINING: % variance explained
            1 comps  2 comps  3 comps  4 comps  5 comps  6 comps  7 comps
X             19.01    27.26    32.67    40.05    46.87    54.21    58.84
ENDOWBEGIN    33.44    38.76    41.93    42.47    42.53    42.54    42.54
            8 comps  9 comps  10 comps  11 comps  12 comps  13 comps  14 comps
X             65.66    67.32     74.32     81.10     87.63     93.12    100.00
ENDOWBEGIN    42.54    42.54     42.54     42.54     42.54     42.54     42.54</code></pre>
</div>
</div>
<p>it takes 13 components to explain 90% of variation in the x variables. it takes 3 components to explain 40% of components in the y variables.</p>
<p>Create the model with scaling and K=10 fold cross-validation. (Use seed 123).</p>
<p>How many principal components are</p>
<ul>
<li>Needed to explain 90% of the total variation <em>among X-variables</em>?</li>
<li>Needed to explain 40% of the total variation <em>of the response</em>, <code>ENDOWBEGIN</code>?</li>
<li>What is the optimal number of PCs based on adjusted Cross-Validation RMSEP?</li>
<li>What is the adjusted Cross Validation MSEP for the optimal number of PCs</li>
<li>Show the validation plot.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="fu">validationplot</span>(plsr_model, <span class="at">val.type =</span> <span class="st">"RMSEP"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Final_627_Tshiani_files/figure-html/unnamed-chunk-18-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>optimal number of CVs are around 3-4</p>
</section>
<section id="summary" class="level2" data-number="2.4">
<h2 data-number="2.4" class="anchored" data-anchor-id="summary"><span class="header-section-number">2.4</span> Summary</h2>
<p>Create a summary table showing the method, the MSE, and the number of predictors.</p>
<ul>
<li>Recommend a model for predicting <code>ENDOWBEGIN</code> for new observations and explain your choice.</li>
</ul>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Method</th>
<th style="text-align: center;">Predicted MSE</th>
<th style="text-align: center;">Number of Predictors</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Linear Model (Reduced)</td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
</tr>
<tr class="even">
<td>LASSO lambda.1se</td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
</tr>
<tr class="odd">
<td>PCR</td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
</tr>
<tr class="even">
<td>PLSR</td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
</tr>
</tbody>
</table>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tibble)</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(boot)</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(glmnet)</span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(pls)</span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. Reduced Linear Model (lm_full assumed to be fitted on college2)</span></span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a>cv_lm <span class="ot">&lt;-</span> <span class="fu">cv.glm</span>(college2, lm_full, <span class="at">K =</span> <span class="dv">10</span>)</span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a>mse_lm <span class="ot">&lt;-</span> cv_lm<span class="sc">$</span>delta[<span class="dv">1</span>]</span>
<span id="cb47-10"><a href="#cb47-10" aria-hidden="true" tabindex="-1"></a>num_lm <span class="ot">&lt;-</span> <span class="fu">length</span>(<span class="fu">coef</span>(lm_full)) <span class="sc">-</span> <span class="dv">1</span>  <span class="co"># exclude intercept</span></span>
<span id="cb47-11"><a href="#cb47-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-12"><a href="#cb47-12" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. LASSO (lambda.1se from lasso_cv)</span></span>
<span id="cb47-13"><a href="#cb47-13" aria-hidden="true" tabindex="-1"></a>mse_lasso <span class="ot">&lt;-</span> lasso_cv<span class="sc">$</span>cvm[lasso_cv<span class="sc">$</span>lambda <span class="sc">==</span> lasso_cv<span class="sc">$</span>lambda<span class="fl">.1</span>se]</span>
<span id="cb47-14"><a href="#cb47-14" aria-hidden="true" tabindex="-1"></a>coef_lasso <span class="ot">&lt;-</span> <span class="fu">coef</span>(lasso_cv, <span class="at">s =</span> <span class="st">"lambda.1se"</span>)</span>
<span id="cb47-15"><a href="#cb47-15" aria-hidden="true" tabindex="-1"></a>num_lasso <span class="ot">&lt;-</span> <span class="fu">sum</span>(coef_lasso <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">-</span> <span class="dv">1</span>  <span class="co"># exclude intercept</span></span>
<span id="cb47-16"><a href="#cb47-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-17"><a href="#cb47-17" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. PLSR (from plsr_model)</span></span>
<span id="cb47-18"><a href="#cb47-18" aria-hidden="true" tabindex="-1"></a>rmsep_plsr <span class="ot">&lt;-</span> <span class="fu">RMSEP</span>(plsr_model, <span class="at">estimate =</span> <span class="st">"adjCV"</span>)</span>
<span id="cb47-19"><a href="#cb47-19" aria-hidden="true" tabindex="-1"></a>mse_plsr <span class="ot">&lt;-</span> <span class="fu">min</span>(rmsep_plsr<span class="sc">$</span>val[<span class="dv">1</span>,<span class="dv">1</span>,<span class="sc">-</span><span class="dv">1</span>])  <span class="co"># remove Comp 0</span></span>
<span id="cb47-20"><a href="#cb47-20" aria-hidden="true" tabindex="-1"></a>num_plsr <span class="ot">&lt;-</span> <span class="fu">which.min</span>(rmsep_plsr<span class="sc">$</span>val[<span class="dv">1</span>,<span class="dv">1</span>,<span class="sc">-</span><span class="dv">1</span>])</span>
<span id="cb47-21"><a href="#cb47-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-22"><a href="#cb47-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine into a summary tibble</span></span>
<span id="cb47-23"><a href="#cb47-23" aria-hidden="true" tabindex="-1"></a>model_summary <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb47-24"><a href="#cb47-24" aria-hidden="true" tabindex="-1"></a>  <span class="at">Method =</span> <span class="fu">c</span>(<span class="st">"Linear Model (Reduced)"</span>, </span>
<span id="cb47-25"><a href="#cb47-25" aria-hidden="true" tabindex="-1"></a>             <span class="st">"LASSO (lambda.1se)"</span>, </span>
<span id="cb47-26"><a href="#cb47-26" aria-hidden="true" tabindex="-1"></a>             <span class="st">"PLSR"</span>),</span>
<span id="cb47-27"><a href="#cb47-27" aria-hidden="true" tabindex="-1"></a>  <span class="at">Predicted_MSE =</span> <span class="fu">c</span>(mse_lm, mse_lasso, mse_plsr),</span>
<span id="cb47-28"><a href="#cb47-28" aria-hidden="true" tabindex="-1"></a>  <span class="at">Num_Predictors =</span> <span class="fu">c</span>(num_lm, num_lasso, num_plsr)</span>
<span id="cb47-29"><a href="#cb47-29" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb47-30"><a href="#cb47-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-31"><a href="#cb47-31" aria-hidden="true" tabindex="-1"></a><span class="co"># Print table</span></span>
<span id="cb47-32"><a href="#cb47-32" aria-hidden="true" tabindex="-1"></a>model_summary</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 3
  Method                 Predicted_MSE Num_Predictors
  &lt;chr&gt;                          &lt;dbl&gt;          &lt;dbl&gt;
1 Linear Model (Reduced)      3875289.             14
2 LASSO (lambda.1se)          5213701.              1
3 PLSR                           1948.              6</code></pre>
</div>
</div>
</section>
<section id="classification-with-svm-optional-extra-credit-4-points" class="level2" data-number="2.5">
<h2 data-number="2.5" class="anchored" data-anchor-id="classification-with-svm-optional-extra-credit-4-points"><span class="header-section-number">2.5</span> Classification with SVM (Optional Extra Credit 4 points)</h2>
<p>We now want to predict whether a new college is Private or Public based on the data in <code>college2</code>.</p>
<p>Tune a Support Vector Machine model to find the best cost and kernel.</p>
<ul>
<li>Use the range of costs in <code>seq(4.0, 6.0, 0.25)</code> and the linear and radial kernels.</li>
</ul>
<p>What is the best cost value and the best kernel and the cross-validated error rate?</p>
<p>Create a model with the best parameters</p>
<ul>
<li>How many support vectors are there?</li>
</ul>
<p>Plot the results looking at <code>ADM_RATE</code> and <code>AVGFACSAL</code>.</p>
<ul>
<li>Comment on the plot</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(e1071)</span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(svm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in rm(svm): object 'svm' not found</code></pre>
</div>
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Tune separately for linear and radial kernels</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>svm_linear <span class="ot">&lt;-</span> <span class="fu">tune</span>(</span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>  svm, CONTROL <span class="sc">~</span> ADM_RATE <span class="sc">+</span> AVGFACSAL,</span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> college2,</span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">kernel =</span> <span class="st">"linear"</span>,</span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">ranges =</span> <span class="fu">list</span>(<span class="at">cost =</span> <span class="fu">seq</span>(<span class="fl">4.0</span>, <span class="fl">6.0</span>, <span class="fl">0.25</span>))</span>
<span id="cb51-8"><a href="#cb51-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb51-9"><a href="#cb51-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-10"><a href="#cb51-10" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb51-11"><a href="#cb51-11" aria-hidden="true" tabindex="-1"></a>svm_radial <span class="ot">&lt;-</span> <span class="fu">tune</span>(</span>
<span id="cb51-12"><a href="#cb51-12" aria-hidden="true" tabindex="-1"></a>  svm, CONTROL <span class="sc">~</span> ADM_RATE <span class="sc">+</span> AVGFACSAL,</span>
<span id="cb51-13"><a href="#cb51-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> college2,</span>
<span id="cb51-14"><a href="#cb51-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">kernel =</span> <span class="st">"radial"</span>,</span>
<span id="cb51-15"><a href="#cb51-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">ranges =</span> <span class="fu">list</span>(<span class="at">cost =</span> <span class="fu">seq</span>(<span class="fl">4.0</span>, <span class="fl">6.0</span>, <span class="fl">0.25</span>))</span>
<span id="cb51-16"><a href="#cb51-16" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb51-17"><a href="#cb51-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-18"><a href="#cb51-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract best cost and error for linear</span></span>
<span id="cb51-19"><a href="#cb51-19" aria-hidden="true" tabindex="-1"></a>best_cost_linear <span class="ot">&lt;-</span> svm_linear<span class="sc">$</span>best.parameters<span class="sc">$</span>cost</span>
<span id="cb51-20"><a href="#cb51-20" aria-hidden="true" tabindex="-1"></a>best_error_linear <span class="ot">&lt;-</span> svm_linear<span class="sc">$</span>best.performance</span>
<span id="cb51-21"><a href="#cb51-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-22"><a href="#cb51-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract best cost and error for radial</span></span>
<span id="cb51-23"><a href="#cb51-23" aria-hidden="true" tabindex="-1"></a>best_cost_radial <span class="ot">&lt;-</span> svm_radial<span class="sc">$</span>best.parameters<span class="sc">$</span>cost</span>
<span id="cb51-24"><a href="#cb51-24" aria-hidden="true" tabindex="-1"></a>best_error_radial <span class="ot">&lt;-</span> svm_radial<span class="sc">$</span>best.performance</span>
<span id="cb51-25"><a href="#cb51-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-26"><a href="#cb51-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Determine overall best kernel and cost</span></span>
<span id="cb51-27"><a href="#cb51-27" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (best_error_linear <span class="sc">&lt;</span> best_error_radial) {</span>
<span id="cb51-28"><a href="#cb51-28" aria-hidden="true" tabindex="-1"></a>  best_kernel <span class="ot">&lt;-</span> <span class="st">"linear"</span></span>
<span id="cb51-29"><a href="#cb51-29" aria-hidden="true" tabindex="-1"></a>  best_cost <span class="ot">&lt;-</span> best_cost_linear</span>
<span id="cb51-30"><a href="#cb51-30" aria-hidden="true" tabindex="-1"></a>  best_error <span class="ot">&lt;-</span> best_error_linear</span>
<span id="cb51-31"><a href="#cb51-31" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb51-32"><a href="#cb51-32" aria-hidden="true" tabindex="-1"></a>  best_kernel <span class="ot">&lt;-</span> <span class="st">"radial"</span></span>
<span id="cb51-33"><a href="#cb51-33" aria-hidden="true" tabindex="-1"></a>  best_cost <span class="ot">&lt;-</span> best_cost_radial</span>
<span id="cb51-34"><a href="#cb51-34" aria-hidden="true" tabindex="-1"></a>  best_error <span class="ot">&lt;-</span> best_error_radial</span>
<span id="cb51-35"><a href="#cb51-35" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb51-36"><a href="#cb51-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-37"><a href="#cb51-37" aria-hidden="true" tabindex="-1"></a><span class="co"># Print results</span></span>
<span id="cb51-38"><a href="#cb51-38" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Best kernel:"</span>, best_kernel, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Best kernel: radial </code></pre>
</div>
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Best cost:"</span>, best_cost, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Best cost: 4 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Cross-validated error rate:"</span>, best_error, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Cross-validated error rate: 0.3225036 </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(e1071)</span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>final_svm <span class="ot">&lt;-</span> <span class="fu">svm</span>(CONTROL <span class="sc">~</span> ADM_RATE <span class="sc">+</span> AVGFACSAL, <span class="at">data =</span> college2,</span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>                 <span class="at">kernel =</span> <span class="st">"radial"</span>, <span class="at">cost =</span> <span class="dv">4</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>final_svm</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
svm(formula = CONTROL ~ ADM_RATE + AVGFACSAL, data = college2, kernel = "radial", 
    cost = 4)


Parameters:
   SVM-Type:  C-classification 
 SVM-Kernel:  radial 
       cost:  4 

Number of Support Vectors:  617</code></pre>
</div>
</div>
<p>617 support vectors</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(final_svm, <span class="at">data =</span> college2[, <span class="fu">c</span>(<span class="st">"ADM_RATE"</span>, <span class="st">"AVGFACSAL"</span>, <span class="st">"CONTROL"</span>)],</span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">"SVM: ADM_RATE vs AVGFACSAL"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Final_627_Tshiani_files/figure-html/unnamed-chunk-23-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>